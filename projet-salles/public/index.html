<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <title>Horaires du jour</title>
    <link rel="stylesheet" href="/resources/styles/style.css" />
    <script type="module" src="/resources/scripts/main.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  </head>
  <body>
    <!-- Header -->
    <div class="header">
      <div class="header-info">
        <div class="selector-info">
          <!-- Logo et nom de la salle sélectionée -->
          <img
            id="site-logo"
            src="/resources/images/pga.png"
            alt="Logo PGA avec fond transparent"
            draggable="false"
          />
          <!-- Liste déroulante pour le choix de salle -->
          <div class="selector">
            <select id="calendar-select">
              <option value="Salle_PGA_Beau-Site_Vignerons">
                Beau-Site - Salle des Vignerons
              </option>
              <option value="Salle_PGA_Beau-Site_Colloque">
                Beau-Site - Salle Colloque
              </option>
              <option value="Salle_PGA_Beau-Site_Espace-Felix">
                Beau-Site - Salle Espace Felix
              </option>
              <option value="Salle_PGA_Beau-Site_Quart-DHeure-Vaudois">
                Beau-Site - Salle Quart d'heure Vaudois
              </option>
              <option value="Salle_PGA_Beau-Site_Veranda">
                Beau-Site - Salle Véranda
              </option>
              <option value="Salle_PGA_Bonnettes_Colloque">
                Bonnettes - Salle Colloque
              </option>
              <option value="Salle_PGA_Coteau-Muraz_Colloque">
                Coteau-Muraz - Salle Colloque
              </option>
              <option value="Test_EBHL">Test_EBHL</option>
              <option value="Test_CDG">Test_CDG</option>
            </select>
          </div>
        </div>

        <!-- Heure mise à jour par le script -->
        <div class="time">
          <div id="clock"></div>
        </div>
      </div>

      <!-- Séparation horizontale -->
      <div class="line"></div>
    </div>

    <!-- Main -->
    <div class="bottom">
      <!-- Partie de gauche -->
      <div class="main">
        <h1 id="status" class="libre"></h1>
        <div class="info-main"></div>
      </div>

      <!-- Séparation -->
      <div class="middle">
        <div class="line"></div>
      </div>

      <!-- Partie de droite -->
      <div class="events"></div>
    </div>

    <!-- Mise à jour de l'URL et des données lors du changement de salle/URL -->
    <script type="module">
      import { ICS_URLS } from "/controllers/ics-roomsData.js";

      const pathParts = window.location.pathname.split("/");
      const site = pathParts[1] || "pga";
      const salleId = pathParts[2] || "Salle_PGA_Beau-Site_Vignerons";

      document.getElementById("calendar-select").value = salleId;
      fetchData(site, salleId);

      document
        .getElementById("calendar-select")
        .addEventListener("change", (e) => {
          const newSalle = e.target.value;
          const newSite = ICS_URLS[newSalle]?.site || "pga";
          window.location.href = `/${newSite}/${newSalle}`;
        });

      async function fetchData(site, id) {
        const res = await fetch(`/api/calendar/${site}/${id}`);
        const events = await res.json();
      }

      const root = document.documentElement;
      const logo = document.getElementById("site-logo");

      if (site === "ebhl") {
        root.style.setProperty("--main-color", "var(--main-color-ebhl)");
        logo.src = "/resources/images/ebhl.png";
      } else if (site === "cdg") {
        root.style.setProperty("--main-color", "var(--main-color-cdg)");
        logo.src = "/resources/images/cdg.png";
      } else {
        root.style.setProperty("--main-color", "var(--main-color-pga)");
        logo.src = "/resources/images/pga.png";
      }
    </script>
  </body>
</html>
