<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <title>Eben-Hézer - Occupation des salles</title>
    <link rel="stylesheet" href="/resources/styles/style.css" />
    <link rel="icon" type="image/png" href="/resources/images/favicon.png" />
    <script type="module" src="/resources/scripts/main.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  </head>
  <body>
    <!-- Header -->
    <div class="header">
      <div class="header-info">
        <div class="selector-info">
          <!-- Logo et nom de la salle sélectionée -->
          <img
            id="site-logo"
            src="/resources/images/pga.png"
            alt="Logo PGA avec fond transparent"
            draggable="false"
          />
          <!-- Liste déroulante pour le choix de salle -->
          <div class="selector">
            <select id="calendar-select">
              <!-- Salles - Eben-Hézer Lausanne -->
              <option value="Salle_des_Pas_Perdus">Salle des Pas Perdus</option>
              <option value="Salle_Victoria">Salle Victoria</option>
              <option value="Bureau_Aumoniers-MJH">Bureau Aumôniers-MJH</option>
              <option value="Bureau_CDL-MJH">Bureau CDL-MJH</option>
              <option value="Test_EBHL">Test_EBHL</option>
              <!-- Salles -  Cité du Genévrier -->
              <option value="Test_CDG">Test_CDG</option>
              <!-- Salles - Pôle Grand Âge -->
              <option value="Salle_PGA_Beau-Site_Vignerons">
                Beau-Site - Salle des Vignerons
              </option>
              <option value="Salle_PGA_Beau-Site_Colloque">
                Beau-Site - Salle Colloque
              </option>
              <option value="Salle_PGA_Beau-Site_Espace-Felix">
                Beau-Site - Salle Espace Felix
              </option>
              <option value="Salle_PGA_Beau-Site_Quart-DHeure-Vaudois">
                Beau-Site - Salle Quart d'heure Vaudois
              </option>
              <option value="Salle_PGA_Beau-Site_Veranda">
                Beau-Site - Salle Véranda
              </option>
              <option value="Salle_PGA_Bonnettes_Colloque">
                Bonnettes - Salle Colloque
              </option>
              <option value="Salle_PGA_Coteau-Muraz_Colloque">
                Coteau-Muraz - Salle Colloque
              </option>
            </select>
          </div>
        </div>

        <!-- Heure mise à jour par le script -->
        <div class="time">
          <div id="clock">
            <iframe
              src="https://www.zeitverschiebung.net/clock-widget-iframe-v2?language=fr&size=medium&timezone=Europe%2FZurich&show=hour_minute"
              width="100%"
              height="140"
              frameborder="0"
              seamless
              style="pointer-events: none"
            ></iframe>
          </div>
        </div>
      </div>

      <!-- Séparation horizontale -->
      <div class="line"></div>
    </div>

    <!-- Main -->
    <div class="bottom">
      <!-- Partie de gauche -->
      <div class="main">
        <h1 id="status" class="libre"></h1>
        <div class="info-main"></div>
      </div>

      <!-- Séparation -->
      <div class="middle">
        <div class="line"></div>
      </div>

      <!-- Partie de droite -->
      <div class="events"></div>
    </div>

    <!-- Mise à jour de l'URL et des données lors du changement de salle/URL -->
    <script type="module">
      import { ROOMS_DATA } from "/controllers/roomsData.js";

      // Récupération des informations sur le site et le nom de la salle depuis l'URL
      const pathParts = window.location.pathname.split("/");
      const site = pathParts[1] || "pga";
      const salleId = pathParts[2] || "Salle_PGA_Beau-Site_Vignerons";

      // Mise à jour du titre de la salle
      document.getElementById("calendar-select").value = salleId;
      fetchData(site, salleId);

      // Mise à jour de l'URL lors du changement de salle depuis la liste déroulante
      document
        .getElementById("calendar-select")
        .addEventListener("change", (e) => {
          const newSalle = e.target.value;
          const newSite = ROOMS_DATA[newSalle]?.site || "pga";
          window.location.href = `/${newSite}/${newSalle}`;
        });

      async function fetchData(site, id) {
        const res = await fetch(`/api/calendar/${site}/${id}`);
        const events = await res.json();
      }

      const root = document.documentElement;
      const logo = document.getElementById("site-logo");

      // Mise à jour du style et du logo en fonction du site
      switch (site) {
        case "ebhl":
          root.style.setProperty("--main-color", "#f1ab01");
          logo.src = "/resources/images/ebhl.png";
          break;
        case "cdg":
          root.style.setProperty("--main-color", "#db3368");
          logo.src = "/resources/images/cdg.png";
          break;
        default:
          root.style.setProperty("--main-color", "#335daa");
          logo.src = "/resources/images/pga.png";
      }
    </script>
  </body>
</html>
